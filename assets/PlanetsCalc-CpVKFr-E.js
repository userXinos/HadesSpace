import{d as ae,g as le,i as O,j as se,S as ne,a as oe,s as re,x as H,b as d,f as o,e as D,w as V,u as L,h as j,m as ie,M as ue,r as ce,o as p,F as T,B as y,t as P,R as de,A as G,z as pe,_ as me}from"./index-BljZxXZT.js";import{l as X,Y as q}from"./planet_levels-unpUm6_N.js";import{V as fe,o as I,p as ve}from"./Data-CGgBqlXK.js";import{s as Ce}from"./spacebuildings-CVaBZ2bu.js";import{g as Se}from"./globals-Bsrkz2nJ.js";import{C as _e}from"./Calculator-Ia8DN6ZQ.js";import{N as ge}from"./NumberPicker-CFqDGsQ6.js";import{g as Te}from"./getFilterByType-mSKMdPnQ.js";import"./sec2str-Bc3nV8nX.js";import"./MultiConfigGUI-DxfCKQ58.js";import"./byTypes-DiOuyN-I.js";function he(N){return N[0].map((F,R)=>N.map(b=>b[R]))}const Le={class:"wrap"},ye={class:"container"},Ae={class:"switch"},Pe={class:"name"},Re=["checked"],be=["onChange"],Me=["selected"],Ee={class:"number-picker"},De=["onClick"],Ie={class:"modal-module"},Ne={class:"chars"},ke={class:"output"},Ue=ae({__name:"PlanetsCalc",setup(N){const{SP2ShipmentsBoostPct:F}=Se,R={CreditStorage:"CreditStorageModifier",FuelStorage:"FuelStorageModifier",CreditsPerHour:"CreditIncomeModifier",FuelPerHour:"FuelIncomeModifier",ShipmentsCRValuePerDay:"CreditShipmentModifier"},b={TotalShipmentCRPerDay:"ShipmentsCRValuePerDay",Cost:"Cost",ConstructionTime:"TimeToUpgrade"},B=["XPAward","Cost","TimeToUpgrade","TimeToUpgradeParallel","RSLevelReq"],$=["CrystalsWeight","Name"],K=Object.keys(X).filter(a=>![...B,...$].includes(a)),Y=Object.values(q.NumMoons).reduce((a,e,i)=>(e&&(Array.isArray(e)?e.forEach((t,l)=>a[q.PlanetTypes[i][l]]=t):a[q.PlanetTypes[i]]=e),a),{}),k=re(),{t:Z}=le(),W=O([]),S=O({actually:{},plan:{}}),U=O(!1),h=se({size:ne.SMALL,title:"name",data:{planet:{},get key(){return this.planet.Name}}}),_=oe(()=>Object.values(W.value));let f;k.subscribe(a=>{a.type==H.SWITCH_PLANETS_CALC_SP2&&f&&(w(f),f.forceReCalc()),a.type==H.SET_CALC_DAY_CREDIT_LIMIT&&f.forceReCalc()});function w(a){f=a,W.value=a.provideGetterElements(te)}function J(a){h.title=Z(a.TID),h.data.planet=a,U.value=!0}function z(a,e){return f.outputClasses(a,h.data.key,e)}function Q(a,e){_.value.forEach(async({Name:i})=>{i.startsWith("TradingStation")||f.onChangeLvl(a,i,parseInt(e))})}function ee(a,e){let i=0;const t={};for(const l of K)e.total.intermediate[l]={actually:0,plan:0,sum:0};return pe(()=>e.total.result.TimeToUpgrade,()=>{i=0}),function(l,s){var r,v;const u=k.state.userSettings.calcDayCreditLimit/24;let n=0;for(const c of K)e.total.intermediate[c].actually+=((r=e.actually[l])==null?void 0:r[c])||0,e.total.intermediate[c].plan+=((v=e.plan[l])==null?void 0:v[c])||0,e.total.intermediate[c].sum=e.total.intermediate[c].actually+e.total.intermediate[c].plan;if(a[l].RSLevelReq){const c=a[l].RSLevelReq[s.plan[l]-1]||0;i=e.total.result.RSLevelReq=i<c?c:i}if(a[l].TimeToUpgrade){const c=a[l],A=s.actually[l],M=s.plan[l],m=[];for(let C=0;C<M-A;C++){const g=A+C,x=c.TimeToUpgrade[g]/3600;for(let E=0;E<x;E++)m.push(c.Cost[g]/(c.TimeToUpgrade[g]/3600))}m.length?t[l]=m:delete t[l],Object.keys(t).length&&(he(Object.values(t)).forEach(C=>{const g=C.reduce((x,E)=>x+E||0,0);n+=Math.ceil(g/u)}),e.total.result.TimeToUpgradeParallel=n*3600)}}}function te(...[a,e]){const i=k.state.userSettings.planetsCalcSp2?F/100:0,t=I(X,{filter:([,n])=>Array.isArray(n)}),l=I(ve,{...Te("planets.yellowstar"),map:([n,r])=>(e[n]=I(t,{map:([v,c])=>{const A=r.MaxUpgradeLevel,M=(r.Name in Y?Y[r.Name]:0)+1;let m=c.map(C=>C*(v in R?r[R[v]]/100:1));return v=="ShipmentsCRValuePerDay"&&(m=m.map(C=>{const g=C*M;return g+g*i})),v=="MaxShipments"&&(m=m.map(C=>C*M)),m.length<A&&m.push(...Array.from({length:A-m.length},()=>m[m.length-1])),[v,m]}}),[n,r])});let s=0;const u=I(Ce.TradingStation,{map:([n,r])=>(Array.isArray(r)&&r.length>s&&(s=r.length),n=="TotalShipmentCRPerDay"&&(r=r.map(v=>v+v*i)),[n in b?b[n]:n,r])});u.MaxUpgradeLevel=s;for(let n=0;u.MaxOnOwnSolarSystem>n;n++){const r={...u,Name:`${u.Name}_${n}`};l[r.Name]=r,e[r.Name]=a(r,s)}return l}return(a,e)=>{const i=ce("t");return p(),d("div",Le,[o("div",ye,[D(_e,{input:S.value,"onUpdate:input":e[0]||(e[0]=t=>S.value=t),"stack-chars":B,"calc-total":ee,"local-storage-key":"planetsCalc","title-key":"PLANETS_CALC",onSetup:w},null,8,["input"]),o("div",Ae,[o("div",null,[V(o("p",Pe,null,512),[[i,"TID_STARTER_PACK_2"]]),e[3]||(e[3]=o("p",null,null,-1))]),o("input",{id:"compact-mode",class:"checkbox",type:"checkbox",checked:a.$store.state.userSettings.planetsCalcSp2,onChange:e[1]||(e[1]=t=>a.$store.commit(L(H).SWITCH_PLANETS_CALC_SP2))},null,40,Re),e[4]||(e[4]=o("label",{for:"compact-mode",class:"label"},null,-1))]),D(fe,{data:{TID:"",Name:"Input",TID2:["",..._.value.map(t=>t.TID)]},"table-opts":{lvlColKey:"â„–",mergeCells:!1,colLvlStartAt:0}},{"table-head":j(()=>[V(o("th",null,null,512),[[i,"CURRENT_LVL"]]),V(o("th",null,null,512),[[i,"PLAN_LVL"]]),e[5]||(e[5]=o("th",null,null,-1))]),"table-body":j(({row:t})=>[t==0?(p(),d(T,{key:0},[(p(!0),d(T,null,y(S.value,(l,s)=>(p(),d("td",{key:s},[o("select",{class:"select",onChange:u=>Q(s,u.target.value)},[(p(!0),d(T,null,y(_.value[t].MaxUpgradeLevel+1,(u,n)=>(p(),d("option",{key:s+u,selected:L(f).isSelected(s,_.value[t].Name,n)},P(n),9,Me))),128))],40,be)]))),128)),e[6]||(e[6]=o("td",null,null,-1))],64)):(p(),d(T,{key:1},[(p(!0),d(T,null,y(S.value,(l,s)=>{var u,n;return p(),d("td",{key:s},[o("div",Ee,[D(ge,{value:((u=S.value[s])==null?void 0:u[_.value[t-1].Name])||0,min:(s=="plan"?(n=S.value.actually)==null?void 0:n[_.value[t-1].Name]:0)||0,max:_.value[t-1].MaxUpgradeLevel,"onUpdate:value":r=>L(f).onChangeLvl(s,_.value[t-1].Name,r)},null,8,["value","min","max","onUpdate:value"])])])}),128)),o("td",null,[o("div",{onClick:()=>J(_.value[t-1])},e[7]||(e[7]=[o("img",{src:de,class:"open-info",alt:"info icon"},null,-1)]),8,De)])],64))]),_:1},8,["data"])]),D(ue,ie({open:U.value,"onUpdate:open":e[2]||(e[2]=t=>U.value=t)},h),{body:j(()=>[o("div",Ie,[o("ul",Ne,[o("li",ke,[o("b",null,P(a.$t("TID_PLANET_LEVEL_DESCR")),1),o("div",null,[(p(!0),d(T,null,y(S.value,(t,l)=>{var s;return p(),d("span",{key:l,class:G(z(l,null))},P((s=S.value[l])==null?void 0:s[h.data.key]),3)}),128))])]),(p(!0),d(T,null,y(Object.keys(L(f).output.plan[h.data.key]||{}).filter(t=>!$.includes(t)),t=>(p(),d("li",{key:t,class:"calc.output"},[o("b",null,P(L(f).format.key(t)),1),o("div",null,[(p(!0),d(T,null,y(S.value,(l,s)=>{var u,n;return p(),d("span",{key:s,class:G(z(s,t))},P(L(f).format.value(t,Math.trunc((n=(u=L(f).output[s])==null?void 0:u[h.data.key])==null?void 0:n[t])||void 0)),3)}),128))])]))),128))])])]),_:1},16,["open"])])}}}),We=me(Ue,[["__scopeId","data-v-6b7d3d70"]]);export{We as default};
