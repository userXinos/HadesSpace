import{j as lt,s as Q,d as at,g as ot,aK as rt,i as B,a as H,E as ut,z as it,aL as ct,b as I,e as D,f,u as v,h as G,t as S,F as $,B as F,M as Y,G as pt,o as T,H as ft,A as N,L as q,N as dt,w as Z,x as yt,S as W,r as Ct,_ as mt}from"./index-ByrvzPMq.js";import{M as x,a as gt}from"./MultiConfigGUI-JR7Sn9iw.js";import{o as z,i as J,v as _t,k as vt}from"./Data-BIcH7QaK.js";import{s as j}from"./globals-CXCjQ2-e.js";function bt(g,h){const d=lt({actually:{},plan:{},total:{intermediate:{},result:{}}}),C={};for(const s of g)d.total.result[s]=0;const R=h(C,d);return{provideGetterElements:b,output:d,update:l};function b(s){return s(m,C)}function l(s,n){const i=(a,p)=>L(a,([u],_,E)=>A(Object.fromEntries(E),u,s.actually[a],p)),r=(a,p)=>L(a,([,u])=>Array.isArray(u)?u[p-1]:u);n?(M(d.plan,n,i(n,s.plan[n])),M(d.actually,n,r(n,s.actually[n]))):(O(s.plan,d.plan,i),O(s.actually,d.actually,r)),w(d.total);for(const[a,p]of Object.entries(d.plan))if(Object.keys(p).length){for(const u of g)d.total.result[u]+=p[u];R(a,s)}}function L(s,n){return(...i)=>{const[[r]]=i;if(V(C[s][r])){const p=z(C[s][r],{map:(...u)=>[u[0][0],n(...u)]});return[r,p]}const a=n(...i);return[r,a]}}function M(s,n,i){C[n]&&(s[n]=z(C[n],{map:i}))}function O(s,n,i){if(Object.keys(s).length)for(const[r,a]of Object.entries(s))a?M(n,r,i(r,a)):n[r]={};else for(const r of Object.keys(n))delete n[r]}function A(s,n,i,r){const a=s[n],p=i>0?a[i-1]:0;let u=a[r-1];if(!Array.isArray(a))return!i&&r?a:0;if(g.includes(n)){u=0;let _=i>0?i-1:0;for(;_<=r-1;)u+=a[_],_++}return u-p}function w(s){for(const n in s)if(n in s){if(V(s[n])){w(s[n]);continue}s[n]=0}}function m(s,n){const i=At(s);return r(i),i;function r(a){for(const p in a)if(p in a){const u=a[p],_=typeof u[1]=="boolean"?u[0]:u;if(V(_)){const E=m(_,n);Object.keys(E).length?a[p]=E:delete a[p];continue}else if(!(Array.isArray(_)&&_.length==n)&&!g.includes(p)){delete a[p];continue}typeof u[1]=="boolean"&&(a[p]=_)}return a}}}function V(g){return typeof g=="object"&&!Array.isArray(g)&&g!==null}function At(g){const h=Q(),d=z(g,{map:([C,R])=>[C,[R,J(C,g.Name)]],filter:([C,[,R]])=>{var b,l;return C.startsWith("_")||J(C,null,{asMeta:!0,asTitle:!1})?!1:(l=(b=h==null?void 0:h.state)==null?void 0:b.userSettings)!=null&&l.disableFilters?!0:!R}});if(g.projectile){const{projectile:C}=d;delete d.projectile,d.projectile=C}return d}const Et={class:"topic"},It={class:"table-and-buttons"},Tt={class:"total-table"},Mt={key:0,colspan:"3"},St={class:"buttons"},ht={class:"reset-buttons"},Rt={class:"settings-modal"},Lt={class:"input-wrap"},Ot=["value"],wt={class:"info"},Dt=at({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(g,{emit:h}){const d=x,C=Q(),{t:R}=ot(),b=ut(),l=g,L=h,M={key:e=>vt(e,b.currentRoute.value.name),value:(e,t)=>_t(e,t,b.currentRoute.value.name)},{provideGetterElements:O,output:A,update:w}=bt(l.stackChars,l.calcTotal),m=new d(l.localStorageKey,{actually:{},plan:{}}),s=rt(()=>{u(),_(),m.save()},100),n={output:A,onChangeLvl:U,isSelected:et,isDisabled:nt,outputClasses:st,forceReCalc:E,format:M,Config:m.store,provideGetterElements:e=>O(e)},i=B(!1),r=B(!1),a=H(()=>R(l.titleKey)),p=H(()=>Object.keys(A.total.result));if(b.currentRoute.value.query.d){const e=x.parseUrl(b.currentRoute.value.query.d),t={actually:{...e},plan:{...e}};m.add(t,{temporary:!0})}E(),L("setup",n),it(()=>m.store.selected,()=>{E()});function u(){L("update:input",m.selectedConfig)}function _(e){ct(()=>w(l.input,e))}function E(){u(),_()}async function K(e){if(e.target.name=="all")await C.dispatch(pt.OPEN_CONFIRM,"Reset all ? Are you serious ?").then(()=>{for(const t in l.input)t in l.input&&(m.selectedConfig[t]={})}).catch(()=>{});else if(l.input.plan)for(const t in l.input.plan)t in l.input.plan&&(m.selectedConfig.plan[t]=l.input.actually[t]);_(),m.save()}async function X(){m.add({actually:{},plan:{}}),E()}function tt(e,t){const o=A.total.intermediate[t];if(e=="plan")return{"yellow-color plus":o.plan,hide:o.plan==0};if(e=="sum"){const c=o.sum>o.actually;return{"green-color ":c,muffle:!c,hide:o.sum==0}}return{}}function U(e,t,o){o=typeof o=="string"?parseInt(o):o,o==0?(delete l.input[e][t],delete A[e][t]):m.selectedConfig[e][t]=o;const c=l.input.plan[t]||0,y=l.input.actually[t];return y>c&&U("plan",t,y),s(),o}function et(e,t,o){let c=l.input.plan[t]||0;const y=l.input.actually[t];return y>c&&(c=U("plan",t,y)),e=="plan"?o==c:l.input[e][t]==o}function nt(e,t,o){return e!="plan"||!l.input.actually?!1:o<l.input.actually[t]}function st(e,t,o){if(e=="actually")return{none:!!o&&p.value.includes(o),actually:!0};if(e=="plan"){const c=o?A[e][t][o]:void 0;return{"yellow-color":(l.input.actually[t]?l.input.plan[t]>l.input.actually[t]:!0)&&typeof c!="object",plus:!o||!!o&&!p.value.includes(o),none:l.input.plan[t]==l.input.actually[t],plan:!0}}return{}}return(e,t)=>{const o=Ct("t");return T(),I("div",null,[D(v(ft),null,{default:G(()=>[f("title",null,S(a.value),1)]),_:1}),f("h1",Et,S(a.value),1),f("div",It,[f("table",Tt,[(T(!0),I($,null,F(v(A).total.intermediate,(c,y)=>(T(),I("tr",{key:y},[f("td",{class:N([v(j)(y),"stats-style"])},S(M.key(y)),3),(T(!0),I($,null,F(c,(P,k)=>(T(),I("td",{key:y+k,class:N(tt(k,y))},S(P.toLocaleString("ru-RU")),3))),128))]))),128)),(T(!0),I($,null,F(v(A).total.result,(c,y)=>(T(),I("tr",{key:y,class:"result"},[f("td",{class:N([v(j)(y),"stats-style"])},[dt(S(M.key(y))+" ",1),y=="TimeToUpgradeParallel"?(T(),I("span",{key:0,class:"show-info",onClick:t[0]||(t[0]=P=>r.value=!0)})):q("",!0)],2),c>0?(T(),I("td",Mt,[f("b",null,S(M.value(y,c)),1)])):q("",!0)]))),128))]),f("div",St,[f("div",ht,[f("button",{class:"button yellow",name:"plan",onClick:K},S(e.$t("RESET_PLAN")),1),f("button",{class:"button red",name:"all",onClick:K},S(e.$t("RESET_ALL")),1)]),f("button",{class:"settings",onClick:t[1]||(t[1]=c=>i.value=!0)})])]),D(Y,{open:i.value,"onUpdate:open":[t[3]||(t[3]=c=>i.value=c),t[4]||(t[4]=()=>v(m).save())],title:e.$t("CALCULATOR_SETTINGS"),size:v(W).MEDIUM},{body:G(()=>[f("div",Rt,[f("div",Lt,[Z(f("p",{class:N(["stats-style",v(j)("CreditStorage")])},null,2),[[o,"DAILY_INVESTMENT"]]),f("input",{value:e.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[2]||(t[2]=c=>e.$store.commit(v(yt).SET_CALC_DAY_CREDIT_LIMIT,parseInt(c.target.value)))},null,40,Ot)]),D(gt,{"on-create-new":X,instance:v(m),"data-to-string":v(m).selectedConfig.actually},null,8,["instance","data-to-string"])])]),_:1},8,["open","title","size"]),D(Y,{open:r.value,"onUpdate:open":t[5]||(t[5]=c=>r.value=c),title:e.$t("TID_MORE_INFO_BTN"),size:v(W).MEDIUM},{body:G(()=>[f("div",wt,[Z(f("p",null,null,512),[[o,"UPGRADE_TIME_IN_PARALLEL_INFO"]])])]),_:1},8,["open","title","size"])])}}}),Ft=mt(Dt,[["__scopeId","data-v-79d57787"]]);export{Ft as C};
