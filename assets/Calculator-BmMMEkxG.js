import{j as lt,D as X,d as at,g as ot,aM as rt,i as K,a as H,A as ut,aN as it,o as I,b as M,e as D,h as $,f,t as S,u as v,H as ct,F,C as G,w as Y,B as N,y as pt,S as q,M as Z,R as ft,J as dt,r as yt,O as Ct,L as J,_ as mt}from"./index-CDtHWPxM.js";import{M as W,a as gt}from"./MultiConfigGUI-jwcB2ei6.js";import{o as P,i as Q,k as _t,v as vt}from"./Data-BLJ-C-L0.js";import{s as j}from"./globals-D0lvPSen.js";function bt(g,h){const d=lt({actually:{},plan:{},total:{intermediate:{},result:{}}}),C={};for(const s of g)d.total.result[s]=0;const R=h(C,d);return{provideGetterElements:b,output:d,update:l};function b(s){return s(m,C)}function l(s,n){const i=(a,p)=>L(a,([u],_,E)=>A(Object.fromEntries(E),u,s.actually[a],p)),r=(a,p)=>L(a,([,u])=>Array.isArray(u)?u[p-1]:u);n?(T(d.plan,n,i(n,s.plan[n])),T(d.actually,n,r(n,s.actually[n]))):(O(s.plan,d.plan,i),O(s.actually,d.actually,r)),w(d.total);for(const[a,p]of Object.entries(d.plan))if(Object.keys(p).length){for(const u of g)d.total.result[u]+=p[u];R(a,s)}}function L(s,n){return(...i)=>{const[[r]]=i;if(V(C[s][r])){const p=P(C[s][r],{map:(...u)=>[u[0][0],n(...u)]});return[r,p]}const a=n(...i);return[r,a]}}function T(s,n,i){C[n]&&(s[n]=P(C[n],{map:i}))}function O(s,n,i){if(Object.keys(s).length)for(const[r,a]of Object.entries(s))a?T(n,r,i(r,a)):n[r]={};else for(const r of Object.keys(n))delete n[r]}function A(s,n,i,r){const a=s[n],p=i>0?a[i-1]:0;let u=a[r-1];if(!Array.isArray(a))return!i&&r?a:0;if(g.includes(n)){u=0;let _=i>0?i-1:0;for(;_<=r-1;)u+=a[_],_++}return u-p}function w(s){for(const n in s)if(n in s){if(V(s[n])){w(s[n]);continue}s[n]=0}}function m(s,n){const i=At(s);return r(i),i;function r(a){for(const p in a)if(p in a){const u=a[p],_=typeof u[1]=="boolean"?u[0]:u;if(V(_)){const E=m(_,n);Object.keys(E).length?a[p]=E:delete a[p];continue}else if(!(Array.isArray(_)&&_.length==n)&&!g.includes(p)){delete a[p];continue}typeof u[1]=="boolean"&&(a[p]=_)}return a}}}function V(g){return typeof g=="object"&&!Array.isArray(g)&&g!==null}function At(g){const h=X(),d=P(g,{map:([C,R])=>[C,[R,Q(C,g.Name)]],filter:([C,[,R]])=>{var b,l;return C.startsWith("_")||Q(C,null,{asMeta:!0,asTitle:!1})?!1:(l=(b=h==null?void 0:h.state)==null?void 0:b.userSettings)!=null&&l.disableFilters?!0:!R}});if(g.projectile){const{projectile:C}=d;delete d.projectile,d.projectile=C}return d}const Et={class:"topic"},It={class:"table-and-buttons"},Mt={class:"total-table"},Tt={key:0,colspan:"3"},St={class:"buttons"},ht={class:"reset-buttons"},Rt={class:"settings-modal"},Lt={class:"input-wrap"},Ot=["value"],wt={class:"info"},Dt=at({__name:"Calculator",props:{stackChars:{},calcTotal:{},localStorageKey:{},titleKey:{},input:{}},emits:["update:input","setup"],setup(g,{emit:h}){const d=W,C=X(),{t:R}=ot(),b=ft(),l=g,L=h,T={key:e=>_t(e,b.currentRoute.value.name),value:(e,t)=>vt(e,t,b.currentRoute.value.name)},{provideGetterElements:O,output:A,update:w}=bt(l.stackChars,l.calcTotal),m=new d(l.localStorageKey,{actually:{},plan:{}}),s=rt(()=>{u(),_(),m.save()},100),n={output:A,onChangeLvl:U,isSelected:et,isDisabled:nt,outputClasses:st,forceReCalc:E,format:T,Config:m.store,provideGetterElements:e=>O(e)},i=K(!1),r=K(!1),a=H(()=>R(l.titleKey)),p=H(()=>Object.keys(A.total.result));if(b.currentRoute.value.query.d){const e=W.parseUrl(b.currentRoute.value.query.d),t={actually:{...e},plan:{...e}};m.add(t,{temporary:!0})}E(),L("setup",n),ut(()=>m.store.selected,()=>{E()});function u(){L("update:input",m.selectedConfig)}function _(e){it(()=>w(l.input,e))}function E(){u(),_()}async function k(e){if(e.target.name=="all")await C.dispatch(dt.OPEN_CONFIRM,"Reset all ? Are you serious ?").then(()=>{for(const t in l.input)t in l.input&&(m.selectedConfig[t]={})}).catch(()=>{});else if(l.input.plan)for(const t in l.input.plan)t in l.input.plan&&(m.selectedConfig.plan[t]=l.input.actually[t]);_(),m.save()}async function x(){m.add({actually:{},plan:{}}),E()}function tt(e,t){const o=A.total.intermediate[t];if(e=="plan")return{"yellow-color plus":o.plan,hide:o.plan==0};if(e=="sum"){const c=o.sum>o.actually;return{"green-color ":c,muffle:!c,hide:o.sum==0}}return{}}function U(e,t,o){o=typeof o=="string"?parseInt(o):o,o==0?(delete l.input[e][t],delete A[e][t]):m.selectedConfig[e][t]=o;const c=l.input.plan[t]||0,y=l.input.actually[t];return y>c&&U("plan",t,y),s(),o}function et(e,t,o){let c=l.input.plan[t]||0;const y=l.input.actually[t];return y>c&&(c=U("plan",t,y)),e=="plan"?o==c:l.input[e][t]==o}function nt(e,t,o){return e!="plan"||!l.input.actually?!1:o<l.input.actually[t]}function st(e,t,o){if(e=="actually")return{none:!!o&&p.value.includes(o),actually:!0};if(e=="plan"){const c=o?A[e][t][o]:void 0;return{"yellow-color":(l.input.actually[t]?l.input.plan[t]>l.input.actually[t]:!0)&&typeof c!="object",plus:!o||!!o&&!p.value.includes(o),none:l.input.plan[t]==l.input.actually[t],plan:!0}}return{}}return(e,t)=>{const o=yt("t");return I(),M("div",null,[D(v(ct),null,{default:$(()=>[f("title",null,S(a.value),1)]),_:1}),f("h1",Et,S(a.value),1),f("div",It,[f("table",Mt,[(I(!0),M(F,null,G(v(A).total.intermediate,(c,y)=>(I(),M("tr",{key:y},[f("td",{class:N([v(j)(y),"stats-style"])},S(T.key(y)),3),(I(!0),M(F,null,G(c,(z,B)=>(I(),M("td",{key:y+B,class:N(tt(B,y))},S(z.toLocaleString("ru-RU")),3))),128))]))),128)),(I(!0),M(F,null,G(v(A).total.result,(c,y)=>(I(),M("tr",{key:y,class:"result"},[f("td",{class:N([v(j)(y),"stats-style"])},[Ct(S(T.key(y))+" ",1),y=="TimeToUpgradeParallel"?(I(),M("span",{key:0,class:"show-info",onClick:t[0]||(t[0]=z=>r.value=!0)})):J("",!0)],2),c>0?(I(),M("td",Tt,[f("b",null,S(T.value(y,c)),1)])):J("",!0)]))),128))]),f("div",St,[f("div",ht,[f("button",{class:"button yellow",name:"plan",onClick:k},S(e.$t("RESET_PLAN")),1),f("button",{class:"button red",name:"all",onClick:k},S(e.$t("RESET_ALL")),1)]),f("button",{class:"settings",onClick:t[1]||(t[1]=c=>i.value=!0)})])]),D(Z,{open:i.value,"onUpdate:open":[t[3]||(t[3]=c=>i.value=c),t[4]||(t[4]=()=>v(m).save())],title:e.$t("CALCULATOR_SETTINGS"),size:v(q).MEDIUM},{body:$(()=>[f("div",Rt,[f("div",Lt,[Y(f("p",{class:N(["stats-style",v(j)("CreditStorage")])},null,2),[[o,"DAILY_INVESTMENT"]]),f("input",{value:e.$store.state.userSettings.calcDayCreditLimit,type:"number",min:"0",onInput:t[2]||(t[2]=c=>e.$store.commit(v(pt).SET_CALC_DAY_CREDIT_LIMIT,parseInt(c.target.value)))},null,40,Ot)]),D(gt,{"on-create-new":x,instance:v(m),"data-to-string":v(m).selectedConfig.actually},null,8,["instance","data-to-string"])])]),_:1},8,["open","title","size"]),D(Z,{open:r.value,"onUpdate:open":t[5]||(t[5]=c=>r.value=c),title:e.$t("TID_MORE_INFO_BTN"),size:v(q).MEDIUM},{body:$(()=>[f("div",wt,[Y(f("p",null,null,512),[[o,"UPGRADE_TIME_IN_PARALLEL_INFO"]])])]),_:1},8,["open","title","size"])])}}}),Gt=mt(Dt,[["__scopeId","data-v-79d57787"]]);export{Gt as C};
