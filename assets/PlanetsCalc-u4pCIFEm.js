import{d as le,s as se,g as oe,i as H,j as ne,S as re,a as ie,x as V,r as ce,o as d,b as p,f as n,e as N,w as j,u as y,h as q,F as g,B as A,t as R,m as ue,M as de,z as pe,A as X,p as me,q as _e,T as fe,_ as ve}from"./index-nG3COr5h.js";import{l as Z,Y as F}from"./planet_levels-fKAZq_VB.js";import{o as k,p as he,V as Se}from"./Data-Jd5diCwm.js";import{s as Ce}from"./spacebuildings-NmTc9Pj4.js";import{g as ge}from"./globals-PgLFRr2B.js";import{C as Te}from"./Calculator-jzujcQdq.js";import{N as Le}from"./NumberPicker-9C9W9LRi.js";import{g as ye}from"./getFilterByType-aSftiFBn.js";import"./sec2str-idVJJpvx.js";import"./MultiConfigGUI-pmTdfAKy.js";import"./byTypes-1BYQ2hUk.js";function Ae(T){return T[0].map((B,I)=>T.map(M=>M[I]))}const b=T=>(me("data-v-6b7d3d70"),T=T(),_e(),T),Pe={class:"wrap"},Re={class:"container"},be={class:"switch"},Ie={class:"name"},Me=b(()=>n("p",null,null,-1)),Ee=["checked"],De=b(()=>n("label",{for:"compact-mode",class:"label"},null,-1)),Ne=b(()=>n("th",null,null,-1)),ke=["onChange"],Ue=["selected"],xe=b(()=>n("td",null,null,-1)),Oe={class:"number-picker"},He=["onClick"],Ve=b(()=>n("img",{src:fe,class:"open-info",alt:"info icon"},null,-1)),je=[Ve],qe={class:"modal-module"},Fe={class:"chars"},Be={class:"output"},$e=le({__name:"PlanetsCalc",setup(T){const{SP2ShipmentsBoostPct:B}=ge,I={CreditStorage:"CreditStorageModifier",FuelStorage:"FuelStorageModifier",CreditsPerHour:"CreditIncomeModifier",FuelPerHour:"FuelIncomeModifier",ShipmentsCRValuePerDay:"CreditShipmentModifier"},M={TotalShipmentCRPerDay:"ShipmentsCRValuePerDay",Cost:"Cost",ConstructionTime:"TimeToUpgrade"},$=["XPAward","Cost","TimeToUpgrade","TimeToUpgradeParallel","RSLevelReq"],K=["CrystalsWeight","Name"],Y=Object.keys(Z).filter(a=>![...$,...K].includes(a)),w=Object.values(F.NumMoons).reduce((a,t,i)=>(t&&(Array.isArray(t)?t.forEach((e,l)=>a[F.PlanetTypes[i][l]]=e):a[F.PlanetTypes[i]]=t),a),{}),U=se(),{t:J}=oe(),W=H([]),h=H({actually:{},plan:{}}),x=H(!1),L=ne({size:re.SMALL,title:"name",data:{planet:{},get key(){return this.planet.Name}}}),S=ie(()=>Object.values(W.value));let _;U.subscribe(a=>{a.type==V.SWITCH_PLANETS_CALC_SP2&&_&&(z(_),_.forceReCalc()),a.type==V.SET_CALC_DAY_CREDIT_LIMIT&&_.forceReCalc()});function z(a){_=a,W.value=a.provideGetterElements(ae)}function Q(a){L.title=J(a.TID),L.data.planet=a,x.value=!0}function G(a,t){return _.outputClasses(a,L.data.key,t)}function ee(a,t){S.value.forEach(async({Name:i})=>{i.startsWith("TradingStation")||_.onChangeLvl(a,i,parseInt(t))})}function te(a,t){let i=0;const e={};for(const l of Y)t.total.intermediate[l]={actually:0,plan:0,sum:0};return pe(()=>t.total.result.TimeToUpgrade,()=>{i=0}),function(l,s){var r,f;const c=U.state.userSettings.calcDayCreditLimit/24;let o=0;for(const u of Y)t.total.intermediate[u].actually+=((r=t.actually[l])==null?void 0:r[u])||0,t.total.intermediate[u].plan+=((f=t.plan[l])==null?void 0:f[u])||0,t.total.intermediate[u].sum=t.total.intermediate[u].actually+t.total.intermediate[u].plan;if(a[l].RSLevelReq){const u=a[l].RSLevelReq[s.plan[l]-1]||0;i=t.total.result.RSLevelReq=i<u?u:i}if(a[l].TimeToUpgrade){const u=a[l],P=s.actually[l],E=s.plan[l],m=[];for(let v=0;v<E-P;v++){const C=P+v,O=u.TimeToUpgrade[C]/3600;for(let D=0;D<O;D++)m.push(u.Cost[C]/(u.TimeToUpgrade[C]/3600))}m.length?e[l]=m:delete e[l],Object.keys(e).length&&(Ae(Object.values(e)).forEach(v=>{const C=v.reduce((O,D)=>O+D||0,0);o+=Math.ceil(C/c)}),t.total.result.TimeToUpgradeParallel=o*3600)}}}function ae(...[a,t]){const i=U.state.userSettings.planetsCalcSp2?B/100:0,e=k(Z,{filter:([,o])=>Array.isArray(o)}),l=k(he,{...ye("planets.yellowstar"),map:([o,r])=>(t[o]=k(e,{map:([f,u])=>{const P=r.MaxUpgradeLevel,E=(r.Name in w?w[r.Name]:0)+1;let m=u.map(v=>v*(f in I?r[I[f]]/100:1));return f=="ShipmentsCRValuePerDay"&&(m=m.map(v=>{const C=v*E;return C+C*i})),f=="MaxShipments"&&(m=m.map(v=>v*E)),m.length<P&&m.push(...Array.from({length:P-m.length},()=>m[m.length-1])),[f,m]}}),[o,r])});let s=0;const c=k(Ce.TradingStation,{map:([o,r])=>(Array.isArray(r)&&r.length>s&&(s=r.length),o=="TotalShipmentCRPerDay"&&(r=r.map(f=>f+f*i)),[o in M?M[o]:o,r])});c.MaxUpgradeLevel=s;for(let o=0;c.MaxOnOwnSolarSystem>o;o++){const r={...c,Name:`${c.Name}_${o}`};l[r.Name]=r,t[r.Name]=a(r,s)}return l}return(a,t)=>{const i=ce("t");return d(),p("div",Pe,[n("div",Re,[N(Te,{input:h.value,"onUpdate:input":t[0]||(t[0]=e=>h.value=e),"stack-chars":$,"calc-total":te,"local-storage-key":"planetsCalc","title-key":"PLANETS_CALC",onSetup:z},null,8,["input"]),n("div",be,[n("div",null,[j(n("p",Ie,null,512),[[i,"TID_STARTER_PACK_2"]]),Me]),n("input",{id:"compact-mode",class:"checkbox",type:"checkbox",checked:a.$store.state.userSettings.planetsCalcSp2,onChange:t[1]||(t[1]=e=>a.$store.commit(y(V).SWITCH_PLANETS_CALC_SP2))},null,40,Ee),De]),N(Se,{data:{TID:"",Name:"Input",TID2:["",...S.value.map(e=>e.TID)]},"table-opts":{lvlColKey:"â„–",mergeCells:!1,colLvlStartAt:0}},{"table-head":q(()=>[j(n("th",null,null,512),[[i,"CURRENT_LVL"]]),j(n("th",null,null,512),[[i,"PLAN_LVL"]]),Ne]),"table-body":q(({row:e})=>[e==0?(d(),p(g,{key:0},[(d(!0),p(g,null,A(h.value,(l,s)=>(d(),p("td",{key:s},[n("select",{class:"select",onChange:c=>ee(s,c.target.value)},[(d(!0),p(g,null,A(S.value[e].MaxUpgradeLevel+1,(c,o)=>(d(),p("option",{key:s+c,selected:y(_).isSelected(s,S.value[e].Name,o)},R(o),9,Ue))),128))],40,ke)]))),128)),xe],64)):(d(),p(g,{key:1},[(d(!0),p(g,null,A(h.value,(l,s)=>{var c,o;return d(),p("td",{key:s},[n("div",Oe,[N(Le,{value:((c=h.value[s])==null?void 0:c[S.value[e-1].Name])||0,min:(s=="plan"?(o=h.value.actually)==null?void 0:o[S.value[e-1].Name]:0)||0,max:S.value[e-1].MaxUpgradeLevel,"onUpdate:value":r=>y(_).onChangeLvl(s,S.value[e-1].Name,r)},null,8,["value","min","max","onUpdate:value"])])])}),128)),n("td",null,[n("div",{onClick:()=>Q(S.value[e-1])},je,8,He)])],64))]),_:1},8,["data"])]),N(de,ue({open:x.value,"onUpdate:open":t[2]||(t[2]=e=>x.value=e)},L),{body:q(()=>[n("div",qe,[n("ul",Fe,[n("li",Be,[n("b",null,R(a.$t("TID_PLANET_LEVEL_DESCR")),1),n("div",null,[(d(!0),p(g,null,A(h.value,(e,l)=>{var s;return d(),p("span",{key:l,class:X(G(l,null))},R((s=h.value[l])==null?void 0:s[L.data.key]),3)}),128))])]),(d(!0),p(g,null,A(Object.keys(y(_).output.plan[L.data.key]||{}).filter(e=>!K.includes(e)),e=>(d(),p("li",{key:e,class:"calc.output"},[n("b",null,R(y(_).format.key(e)),1),n("div",null,[(d(!0),p(g,null,A(h.value,(l,s)=>{var c,o;return d(),p("span",{key:s,class:X(G(s,e))},R(y(_).format.value(e,Math.trunc((o=(c=y(_).output[s])==null?void 0:c[L.data.key])==null?void 0:o[e])||void 0)),3)}),128))])]))),128))])])]),_:1},16,["open"])])}}}),tt=ve($e,[["__scopeId","data-v-6b7d3d70"]]);export{tt as default};
